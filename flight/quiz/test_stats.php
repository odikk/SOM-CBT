<?phpdefine('IN_somCBT', true);$phpEx = 'php';$somCBT_root_path = './../';include($somCBT_root_path . 'common.php');$cid =  ( isset($HTTP_GET_VARS['ARG1']) ) ? ($HTTP_GET_VARS['ARG1']) : ( ( isset($HTTP_POST_VARS['ARG1']) ) ? ($HTTP_POST_VARS['ARG1']) : 0) ;$qid =  ( isset($HTTP_GET_VARS['ARG2']) ) ? ($HTTP_GET_VARS['ARG2']) : ( ( isset($HTTP_POST_VARS['ARG2']) ) ? ($HTTP_POST_VARS['ARG2']) : 0) ;//// Start session management//$userdata = session_pagestart($user_ip, PAGE_QUIZ_REPORT);init_userprefs($userdata);//// End session managementif( $userdata['session_logged_in'] && ( ( $userdata['user_level'] == ADMIN) || ( $userdata['user_level'] == TEACHER) ) ) {	include($somCBT_root_path . 'includes/page_header.php');	$template->set_filenames(array(	'body' => 'quiz/test_stats.tpl') );		$sql = " SELECT count(*) AS total_ques FROM ". QUIZ_QUESTIONS_TABLE ." where quiz_id = ". $qid;	$result = $db->sql_query($sql);	$total_ques = $db->sql_fetchrow($result);	$sql = " SELECT * FROM ". QUIZ_QUESTIONS_TABLE ." where quiz_id = ". $qid;	$result = $db->sql_query($sql);	while ($question = $db->sql_fetchrow($result)) {		if($question['qtype']=='2') {			$arr_pts = explode("#", $question['points']);			$pts = $arr_pts[4];			$total_pts = $total_pts + $pts;		}else{			$total_pts = $total_pts + 1;		}	}	$sql = " SELECT quiz_name, kuder FROM ". QUIZ_TABLE ." where quiz_id = ". $qid. " AND course_id =" .$cid;	$result = $db->sql_query($sql);	$test = $db->sql_fetchrow($result);		$sql = " SELECT MAX(grade) as high, MIN(grade) as low, AVG(grade) as ave, STD(grade) as st_dev, count(*) as total_stud  FROM ". QUIZ_ATTEMPTS_TABLE ." where quiz_id = ". $qid;	$result = $db->sql_query($sql);	$test_grade = $db->sql_fetchrow($result);/*		$sql = "SELECT u.user_id, username, user_fname, user_lname, timefinish, timestart, grade FROM ".USERS_TABLE." u, ".COURSE_USERS_TABLE." cu, ".QUIZ_ATTEMPTS_TABLE." qa WHERE cu.course_id = ".$cid." AND cu.user_id = u.user_id AND cu.access_level = '5' AND qa.user_id = u.user_id AND qa.quiz_id = ".$qid . " ORDER BY user_lname";	if ( ($result = $db->sql_query($sql)) ) {		$c =1;		while( $quiz_attempts = $db->sql_fetchrow($result) )		{			if ( $c % 2) { $color = "#FFFFD1";$c=0;} else { $color ="#D4D4D4" ;$c=1;}			$timetaken = calculateDateDiff($quiz_attempts['timefinish'], $quiz_attempts['timestart']) ;			$template->assign_block_vars('quiz_attempts', array('NAME' => $quiz_attempts['user_fname'].' '.$quiz_attempts['user_lname'],																'USERNAME' => $quiz_attempts['username'],																'PERCENT' => round((($quiz_attempts['grade']/$total_ques['total_ques']) * 100 ),1),																'SCORE' => $quiz_attempts['grade'],																'TIME' => $timetaken['hours']. ' h '.$timetaken['minutes'].' min',																'BGCOLOR' => $color										));		}	}*/		$template->assign_vars(array(				'TEST_NAME' => $test['quiz_name'],				'KUDER' => round($test['kuder'],4),				'HIGH_GRADE' => $test_grade['high'],				'LOW_GRADE' => $test_grade['low'],				'TOTAL_STUD' => $test_grade['total_stud'],				'SD' => round($test_grade['st_dev'], 3) ,				'MEAN_GRADE' => round($test_grade['ave'],3),								'TOTAL_QUES' => $total_ques['total_ques'],				'TOTAL_PNTS' => $total_pts,				'HIGH_PER' => round(($test_grade['high']/$total_pts), 3)*100,//edited by SMQ to provide score percentages - added "/$total_ques['...*100 - SMQ				'LOW_PER' => round(($test_grade['low']/$total_pts), 3)*100,//edited by SMQ to provide score percentages - added "/$total_ques['...*100 - SMQ				'SD_PER' => round(($test_grade['st_dev']/$total_pts), 3)*100,//edited by SMQ to provide score percentages - added "/$total_ques['...*100 - SMQ				'MEAN_PER' => round(($test_grade['ave']/$total_pts),3)*100,//edited by SMQ to provide score percentages - added "/$total_ques['...*100 - SMQ				'S_ROOTDIR' => $somCBT_root_path,				'S_NAV' => $nav_path			));}else {	redirect(append_sid("login.php", true));}//// Generate the page//$template->pparse('overall_header');$template->pparse('body');include($somCBT_root_path . 'includes/page_tail.php');?>