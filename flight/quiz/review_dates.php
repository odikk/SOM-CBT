<?phpdefine('IN_somCBT', true);$phpEx = 'php';$somCBT_root_path = './../';include($somCBT_root_path . 'common.php');$cid =  ( isset($HTTP_GET_VARS['ARG1']) ) ? ($HTTP_GET_VARS['ARG1']) : ( ( isset($HTTP_POST_VARS['ARG1']) ) ? ($HTTP_POST_VARS['ARG1']) : 0) ;$qid =  ( isset($HTTP_GET_VARS['ARG2']) ) ? ($HTTP_GET_VARS['ARG2']) : ( ( isset($HTTP_POST_VARS['ARG2']) ) ? ($HTTP_POST_VARS['ARG2']) : 0) ;$action = ( isset($HTTP_POST_VARS['action']) ) ? ($HTTP_POST_VARS['action']) : '' ;//// Start session management//$userdata = session_pagestart($user_ip, PAGE_QUIZ_REPORT);init_userprefs($userdata);//// End session managementif( $userdata['session_logged_in'] &&  ( $userdata['user_level'] == ADMIN)  ) {	include($somCBT_root_path . 'includes/page_header.php');	$template->set_filenames(array(	'body' => 'quiz/review_dates.tpl') );		if ($action == 'save') {		for ( $i =0 ; $i < $HTTP_POST_VARS['count']; $i++) {			$temp[$i] = create_date( sprintf($HTTP_POST_VARS['slot'.($i*2).'_hour'] . ", " . $HTTP_POST_VARS['slot'.($i*2).'_min'] .", 0 , " . $HTTP_POST_VARS['slot'.($i*2).'_date'] . ", " .$HTTP_POST_VARS['slot'.($i*2).'_month'].", ".$HTTP_POST_VARS['slot'.($i*2).'_year']), 0).", ".$HTTP_POST_VARS['count_'.($i*2)];				}		$sql = "UPDATE ". QUIZ_TABLE ." SET review_dates = '".implode(",",$temp)."' WHERE course_id = ". $cid." AND quiz_id = ".$qid;		$r = $db->sql_query($sql) ;		unset($temp);	} // eof save		$sql = "SELECT review_dates FROM ". QUIZ_TABLE . " where quiz_id = ". $qid. " AND course_id = ".$cid. " LIMIT 1";		if ( ($result = $db->sql_query($sql)) ) {						if( $quiz = $db->sql_fetchrow($result) )		{			$month_name = array();			for ($i=1; $i<=12; $i++) {				$month_name[$i] = strftime("%B",mktime(12,0,0,$i,1,2004)) ;			}							$dates = explode(",",$quiz['review_dates']);						for ($i = 0 ; $i < count($dates); $i = $i + 2 ) {				$temp1 = explode(" ",create_date($dates[$i]));				$temp2 = explode (":", $temp1[3]); 				$temp1 = array_merge($temp1, $temp2);								$template->assign_block_vars('review', array('SLOT' => date_selector('slot'.$i,$temp1),																					 'COUNT' => '&nbsp;<input type="text" name="count_'.$i.'" value="'.$dates[($i+1)].'" size="2">',																					 'NOW' => '&nbsp;<a href="javascript:void(0);" class="action" onclick="allow_now(\'slot'.$i.'_\');">&nbsp;Now&nbsp;</a>'													));			} // eof for each			$template->assign_block_vars('review', array('SLOT' => '<a href="javascript:submit_form(document.review ,\'save\')" class="action">Save</a>', 'NOW' => ''));					} 	}	// eof if resultset	$temp5 = explode(" ",create_date(time(),1,"d F Y G:i"));	$temp6 = explode (":", $temp5[3]); 	$temp6[1] = intval($temp6[1]); 	$temp6[0] = intval($temp6[0]); 	$temp5[0] = intval($temp5[0]); // hrs,minutes,date are with leading zeros(05), to strip the first 0 using intval	$temp5 = array_merge($temp5, $temp6);  					$temp5[1] = array_search( $temp5[1], $month_name); // changing year to number format	$temp5 = implode(",",$temp5);		$template->assign_vars(array(				'COUNT' => ( count($dates)/2 ),				'S_ROOTDIR' => $somCBT_root_path,				'S_NAV' => 'Slots for Review',				'TIME' => $temp5,				'Q_POST_ACTION' => append_sid('review_dates.php?ARG1='.$cid.'&ARG2='.$qid)			));				unset($temp5, $months_name);}else {	redirect(append_sid("login.php", true));}//// Generate the page//$template->pparse('overall_header');$template->pparse('body');include($somCBT_root_path . 'includes/page_tail.php');?>