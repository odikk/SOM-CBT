<!doctype html public "-//W3C//DTD HTML 4.0 Frameset//EN"><title>Quiz - Review</title><script language="JavaScript1.2">function setcountdown(theyear,themonth,theday,thehour,themin,thesec){	yr=theyear;mo=themonth;da=theday;hr=thehour;min=themin;sec=thesec}//setcountdown(2004,04,13,15,58,40)var montharray=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec")function countdown(){	var today=new Date()	var todayy=today.getYear()	if (todayy < 1000)		todayy+=1900		var todaym=today.getMonth()	var todayd=today.getDate()	var todayh=today.getHours()	var	todaymin=today.getMinutes()	var todaysec=today.getSeconds()	var todaystring=montharray[todaym]+" "+todayd+", "+todayy+" "+todayh+":"+todaymin+":"+todaysec	futurestring=montharray[mo-1]+" "+da+", "+yr+" "+hr+":"+min+":"+sec	dd=Date.parse(futurestring)-Date.parse(todaystring)	dday=Math.floor(dd/(60*60*1000*24)*1)	dhour=Math.floor((dd%(60*60*1000*24))/(60*60*1000)*1)	dmin=Math.floor(((dd%(60*60*1000*24))%(60*60*1000))/(60*1000)*1)	dsec=Math.floor((((dd%(60*60*1000*24))%(60*60*1000))%(60*1000))/1000*1)	document.title = dhour+" : "+dmin+" : "+dsec;	if(dday<=0&&dhour<=0&&dmin<=0&&dsec<=1&&todayd==da){ 		window.close();			alert(" Sorry ... Time has expired \n \n Closing the Review session");	}	setTimeout("countdown()",1000);}</script><?phpdefine('IN_somCBT', true);$phpEx = 'php';$somCBT_root_path = './../';include($somCBT_root_path . 'common.php');$cid =  ( isset($HTTP_GET_VARS['ARG1']) ) ? ($HTTP_GET_VARS['ARG1']) : ( ( isset($HTTP_POST_VARS['ARG1']) ) ? ($HTTP_POST_VARS['ARG1']) : 0) ;$qid =  ( isset($HTTP_GET_VARS['ARG2']) ) ? ($HTTP_GET_VARS['ARG2']) : ( ( isset($HTTP_POST_VARS['ARG2']) ) ? ($HTTP_POST_VARS['ARG2']) : 0) ;$setid =  ( isset($HTTP_GET_VARS['set']) ) ? ($HTTP_GET_VARS['set']) : ( ( isset($HTTP_POST_VARS['set']) ) ? ($HTTP_POST_VARS['set']) : 0) ;//$total_ques =  ( isset($HTTP_GET_VARS['total']) ) ? ($HTTP_GET_VARS['total']) : ( ( isset($HTTP_POST_VARS['total']) ) ? ($HTTP_POST_VARS['total']) : 0) ;//$attempts =  ( isset($HTTP_GET_VARS['att']) ) ? ($HTTP_GET_VARS['att']) : 1 ;//// Start session management//$userdata = session_pagestart($user_ip, PAGE_QUIZ_QUIZ);init_userprefs($userdata);//// End session managementif( $userdata['session_logged_in']) {	$sql = "SELECT reviewed, grade FROM ". QUIZ_ATTEMPTS_TABLE . " WHERE quiz_id = ". $qid. " AND user_id = ".$userdata['session_user_id'];	if ($result1 = $db->sql_query($sql) ) {		$get_total = $db->sql_fetchrow($result1);		$is_reviewed = $get_total['reviewed'];		$stu_tot = $get_total['grade'];	}		if ( ($is_reviewed['reviewed']== '1') || ($is_reviewed['reviewed'] == '2') ) {		$sql = "SELECT qs.ipfrom, qs.ipto, q.release_quiz, q.review_time FROM ".QUIZ_SETTINGS_TABLE." qs, ". QUIZ_TABLE. " q WHERE qs.timeopen <= ".time(). " AND qs.timeclose >= ".time()." AND qs.set_id = ".$setid." AND q.quiz_id = ". $qid . " AND q.course_id = ".$cid." AND q.quiz_id = qs.quiz_id LIMIT 1";		if ($result = $db->sql_query($sql) ) {			if ($quiz = $db->sql_fetchrow($result)) {							$release_review_options = explode("#", $quiz['release_quiz']);				if ( (isIPInRange(decode_ip($userdata['session_ip']), decode_ip($quiz['ipfrom']), decode_ip($quiz['ipto'])) ) && ($release_review_options[3] == 1)) {							$sql = "SELECT COUNT(*) AS total_ques FROM ". QUIZ_QUESTIONS_TABLE . " WHERE quiz_id = ". $qid;												if ($result1 = $db->sql_query($sql) ) {						if ( $total_ques = $db->sql_fetchrow($result1) ) {						 	$total_ques = $total_ques['total_ques'];						 }					}						$sql2 = "SELECT * FROM ". QUIZ_QUESTIONS_TABLE . " WHERE quiz_id = ". $qid." ORDER BY ques_order";													if ($result2 = $db->sql_query($sql2) ) {							$correct_questions_count = 0;							echo '<script language="JavaScript">';							echo 'window.onload=countdown ;';							echo 'var answered = new Array();';							while ( $type = $db->sql_fetchrow($result2) ) {								if ($type['qtype']=='1') {										$sql = " SELECT answer, grade, status FROM ".QUIZ_RESPONSES_TABLE. " WHERE user_id = ". $userdata['session_user_id']. " AND quiz_id = ". $qid. " AND question_id = ".$type['ques_id']." LIMIT 1";									if ($result3 = $db->sql_query($sql) ) {												if ( $status = $db->sql_fetchrow($result3)) {											if ($status['grade'] == 1) { // correct												$correct_questions_count = $correct_questions_count+1;												if ($status['status'] == 4) { // marked during the test													echo 'answered['.$type['ques_order'].'] = 3 ;';												}												elseif ($status['status'] == 2) { // unmarked and correct													echo 'answered['.$type['ques_order'].'] = 1 ;';												}											}											else if ($status['grade'] == -1) {// incorrect												if ($status['status'] == 4) { // marked during the test													echo 'answered['.$type['ques_order'].'] = 4 ;';												}												elseif ($status['status'] == 2) { // unmarked and wrong													echo 'answered['.$type['ques_order'].'] = 2 ;';												}											}										}									}								} elseif ($type['qtype']=='2') {									$sql = "SELECT point, status FROM ".QUIZ_TEXT_RESPONSES_TABLE. " WHERE user_id = ". $userdata['session_user_id']. " AND quiz_id = ". $qid. " AND question_id = ".$type['ques_id']." LIMIT 1";									if ($result3 = $db->sql_query($sql) ) {										if ( $status = $db->sql_fetchrow($result3)) {											echo 'answered['.$type['ques_order'].'] = 5 ;';										}									}								}//end question type conditional - SMQ							}//end while loop - SMQ						}//end quiz_questions result set - SMQ										if ( ($release_review_options[4] == 1) && ($release_review_options[3] == 1) ) { // only incorrect							echo 'setcountdown('.create_date( (time()+($quiz['review_time']*60*($total_ques - $correct_questions_count) ) +10) ,1, "Y,m,d,H,i,s").');';										} else if ( ($release_review_options[5] == 1) && ($release_review_options[3] == 1) ){ // all							echo 'setcountdown('.create_date( (time()+ ($quiz['review_time']*60)+10 ) ,1, "Y,m,d,H,i,s").');';						}						echo '</script>';						echo '<frameset cols=\'*,220\' border="1" >';						echo '<frame src="'.append_sid('quiz_review.php?ARG1='.$cid.'&ARG2='.$qid.'&set='.$setid).'" name="questions" title="Quiz listing" scrolling=auto>';						echo '<frame marginwidth=0 marginheight=0 scrolling="auto" src="'.append_sid('review_status.php?ARG1='.$cid.'&ARG2='.$qid.'&ARG3='.$correct_questions_count.'&totalpts='.$stu_tot.'&set='.$setid).'" name="bottom" title="Question Status">';						echo '</frameset><noframes></noframes>';											$sql = "UPDATE ".QUIZ_ATTEMPTS_TABLE." SET reviewed='3' where quiz_id = ". $qid. " AND user_id = ".$userdata['session_user_id'];						$db->sql_query($sql);						} // eof ip in range				}// eof quiz resulset					}// eof quiz fetchrow		}// eof not reviewed		else { // already reviewed			echo "<br><br><br><br><br><br><br><center><font color=\"#FF0000\"><b>You have already reviewed the Test</b></font></center>";		}	}/*	1 -> No need for Review	2 -> Need Review, but not reviewed	3 -> Need review & reviewed*/?><layer left=0 top=0></layer></html>