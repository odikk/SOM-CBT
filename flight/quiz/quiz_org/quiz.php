<?phpdefine('IN_somCBT', true);$phpEx = 'php';$somCBT_root_path = './../';include($somCBT_root_path . 'common.php');$cid =  ( isset($HTTP_GET_VARS['ARG1']) ) ? ($HTTP_GET_VARS['ARG1']) : ( ( isset($HTTP_POST_VARS['ARG1']) ) ? ($HTTP_POST_VARS['ARG1']) : 0) ;$qid =  ( isset($HTTP_GET_VARS['qid']) ) ? ($HTTP_GET_VARS['qid']) : ( ( isset($HTTP_POST_VARS['qid']) ) ? ($HTTP_POST_VARS['qid']) : 0) ;$offset =  ( isset($HTTP_GET_VARS['offset']) ) ? ($HTTP_GET_VARS['offset']) : ( ( isset($HTTP_POST_VARS['offset']) ) ? ($HTTP_POST_VARS['offset']) : 0) ;//// Start session management//$userdata = session_pagestart($user_ip, PAGE_QUIZ_QUIZ);init_userprefs($userdata);//// End session managementif( $userdata['session_logged_in']) {	include($somCBT_root_path . 'includes/page_header.php');	$template->set_filenames(array(		'body' => 'quiz/quiz_body.tpl')		);	$sql = "SELECT ipfrom, ipto FROM ". QUIZ_TABLE. " WHERE timeopen <= ".time(). " AND timeclose >= ".time()." AND quiz_id = ". $qid . " AND course_id = ".$cid." LIMIT 1";		if ($result = $db->sql_query($sql) ) {		if ($quiz = $db->sql_fetchrow($result)) {			if (isIPInRange(decode_ip($userdata['session_ip']), decode_ip($quiz['ipfrom']), decode_ip($quiz['ipto'])) ) {				$sql = "SELECT * FROM  ".QUIZ_QUESTIONS_TABLE." 							WHERE quiz_id = ".$qid." AND course_id = ".$cid." AND ques_order = ".$offset." AND ques_id = ques_id LIMIT 1";				if ($result = $db->sql_query($sql) ) {					if ($question = $db->sql_fetchrow($result)) {						switch ($question['qtype']) {											case MULTIPLECHOICE :							{								$sql1 = "SELECT answer FROM ".QUIZ_RESPONSES_TABLE . " WHERE quiz_id = ".$qid. " AND question_id = ".$question['ques_id']." AND user_id =".$userdata['session_user_id'];																$ans = '';								if ($result2 = $db->sql_query($sql1) ) {									if ( $ans = $db->sql_fetchrow($result2) ) {										$ans = $ans['answer'];									} // eof ans															}//  eof result2								$letters = array("A.","B.","C.","D.","E.", "F.");								for ( $z = 0; $z < 6; $z++) {									if (!empty($question['choice'.($z+1)])) {										if ( $ans == ($z+1) ) {											$ques_options .='<p>&nbsp;&nbsp;<input type="radio" name="ans" value="'.($z+1).'" onclick="register_change(\''.($offset).'\');" checked>';																				}										else {											$ques_options .='<p>&nbsp;&nbsp;<input type="radio" name="ans" value="'.($z+1).'" onclick="register_change(\''.($offset).'\');">';										}										$ques_options .= '&nbsp;&nbsp;'.$letters[$z].'&nbsp;&nbsp;'.$question['choice'.($z+1)]."</p>";																}													}									break;							} // eof multiplechoice						} // eof switch							$template->assign_block_vars('question',array('QNO' => $offset,																		'QID' => $question['ques_id'],																		'STEM' => $question['stem'],																		'ATTRIBUTES' => $ques_options																						));										} // eof if question									} // eof resultset				} // eof IP in range		} // eof quiz fetch row	} // eof quiz resultset			$template->assign_vars(array(			'S_ROOTDIR' => $somCBT_root_path,			'Q_FORM_ACTION' => append_sid('status.php'),			'COURSE_ID' => $cid,					'QUIZ_ID' => $qid,			'OFFSET' => $offset,			'S_NAV' => $nav_path)		);}else {	redirect(append_sid("login.$phpEx", true));}//// Generate the page//$template->pparse('overall_header');$template->pparse('body');include($somCBT_root_path . 'includes/page_tail.'.$phpEx);?>