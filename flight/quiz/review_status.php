<?phpdefine('IN_somCBT', true);$phpEx = 'php';$somCBT_root_path = './../';include($somCBT_root_path . 'common.php');$cid =  ( isset($HTTP_GET_VARS['ARG1']) ) ? ($HTTP_GET_VARS['ARG1']) : ( ( isset($HTTP_POST_VARS['ARG1']) ) ? ($HTTP_POST_VARS['ARG1']) : 0) ;$qid =  ( isset($HTTP_GET_VARS['ARG2']) ) ? ($HTTP_GET_VARS['ARG2']) : ( ( isset($HTTP_POST_VARS['ARG2']) ) ? ($HTTP_POST_VARS['ARG2']) : 0) ;$correct_count =  ( isset($HTTP_GET_VARS['ARG3']) ) ? ($HTTP_GET_VARS['ARG3']) :  0 ;$stu_total = ( isset($HTTP_GET_VARS['totalpts']) ) ? ($HTTP_GET_VARS['totalpts']) :  0 ;$setid =  ( isset($HTTP_GET_VARS['set']) ) ? ($HTTP_GET_VARS['set']) : ( ( isset($HTTP_POST_VARS['set']) ) ? ($HTTP_POST_VARS['set']) : 0) ;//// Start session management//$userdata = session_pagestart($user_ip, PAGE_QUIZ_CREATE);init_userprefs($userdata);//// End session managementif( $userdata['session_logged_in'] ) {	include($somCBT_root_path . 'includes/page_header.'.$phpEx);	$template->set_filenames(array(		'body' => 'quiz/review_status.tpl')		);			$sql = "SELECT COUNT(*) AS total_ques FROM ". QUIZ_QUESTIONS_TABLE . " WHERE quiz_id = ". $qid;								if ($result1 = $db->sql_query($sql) ) {		if ( $total_ques = $db->sql_fetchrow($result1) ) {		 	$total_ques = $total_ques['total_ques'];		 }	}//EDIT HERE - SMQ/////////////////////////////////////////////////////////////////////////////////////////////////////////	$sql = "SELECT q.release_quiz, qs.ipfrom, qs.ipto, c.media_dir FROM ". QUIZ_TABLE. " q, ".QUIZ_SETTINGS_TABLE." qs, ".COURSE_TABLE." c WHERE qs.timeopen <= ".time(). " AND qs.timeclose >= ".time()." AND q.quiz_id = ". $qid . " AND q.course_id = ".$cid." AND qs.set_id = ".$setid." AND q.course_id = c.course_id LIMIT 1";			//$sql = "SELECT ipfrom, ipto, release_quiz FROM ". QUIZ_TABLE. " WHERE timeopen <= ".time(). " AND timeclose >= ".time()." AND quiz_id = ". $qid . " AND course_id = ".$cid." LIMIT 1";	if ($result = $db->sql_query($sql) ) {		if ($quiz = $db->sql_fetchrow($result)) {			$release_review_options = explode("#", $quiz['release_quiz']);						if ( (isIPInRange(decode_ip($userdata['session_ip']), decode_ip($quiz['ipfrom']), decode_ip($quiz['ipto'])) ) && ( $release_review_options[3] == 1)) {								$sql2 = " SELECT * FROM ".QUIZ_QUESTIONS_TABLE. " WHERE course_id=".$cid. " AND quiz_id=".$qid. " ORDER BY ques_order";				if ($result2 = $db->sql_query($sql2) ) {									for ($count = 0; $count < $total_ques; $count++ ) {						$question = $db->sql_fetchrow($result2);						if ($question['qtype']=='2') {							$pnt_arr = explode("#", $question['points']);							$pnts = $pnt_arr[4];							$totpnts = $totpnts + $pnts;						}else{							$totpnts = $totpnts + 1;						}												if ($count % 5 == 0 ) {							$template->assign_block_vars('status', array());						}						$template->assign_block_vars('status.question', array('QNO' => ( $count + 1),														'SRC' => append_sid('quiz_review.php?ARG1='.$cid.'&ARG2='.$qid.'&ARG3='.$question['ques_id'].'&ARG4='.($count+1).'&dir='.$quiz['media_dir'].'&set='.$setid)						));					} // eof count questions				}			} // eof IP in range		} // eof quiz fetch row	} // eof quiz resultset	$template->assign_vars(array(			'CID' => $cid,			'SCORE' => $stu_total.' out of '.$totpnts,			'QID' => $qid,			'SETID' => $setid,			'FINISH_ACTION' => append_sid('submit.php'),			'S_ROOTDIR' => $somCBT_root_path,			'L_LOGIN_LOGOUT' => '', // remove the logout link from the top			'S_NAV' => $nav_path)		);}else {	redirect(append_sid("login.$phpEx", true));}//// Generate the page//$template->pparse('overall_header');$template->pparse('body');include($somCBT_root_path . 'includes/page_tail.'.$phpEx);?>