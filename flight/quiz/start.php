<!doctype html public "-//W3C//DTD HTML 4.0 Frameset//EN"><title>Quiz</title><script language="JavaScript1.2">function setcountdown(theyear,themonth,theday,thehour,themin,thesec){	yr=theyear;mo=themonth;da=theday;hr=thehour;min=themin;sec=thesec;}//setcountdown(2004,04,13,15,58,40)var montharray=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec") window.onload=countdownfunction countdown(username){	var today=new Date()	var todayy=today.getYear()	if (todayy < 1000)		todayy+=1900		var todaym=today.getMonth()	var todayd=today.getDate()	var todayh=today.getHours()	var	todaymin=today.getMinutes()	var todaysec=today.getSeconds()	var todaystring=montharray[todaym]+" "+todayd+", "+todayy+" "+todayh+":"+todaymin+":"+todaysec	futurestring=montharray[mo-1]+" "+da+", "+yr+" "+hr+":"+min+":"+sec	dd=Date.parse(futurestring)-Date.parse(todaystring)	dday=Math.floor(dd/(60*60*1000*24)*1)	dhour=Math.floor((dd%(60*60*1000*24))/(60*60*1000)*1)	dmin=Math.floor(((dd%(60*60*1000*24))%(60*60*1000))/(60*1000)*1)	dsec=Math.floor((((dd%(60*60*1000*24))%(60*60*1000))%(60*1000))/1000*1)	document.title = dhour+" : "+dmin+" : "+dsec;	if(dday <=0 && dhour <= 0 && dmin<=0 && dsec<=1 && todayd==da){ 		alert(" Sorry ... Time has expired \n \n Only the saved & marked questions will be considered");		top.bottom.doFinish(0);	}	if(dday <=0 && dhour <= 0 && dmin<=0 && dsec<=-0){ 		window.close();	}	setTimeout("countdown()",1000)}</script><?phpdefine('IN_somCBT', true);$phpEx = 'php';$somCBT_root_path = './../';include($somCBT_root_path . 'common.php');$cid =  ( isset($HTTP_GET_VARS['ARG1']) ) ? ($HTTP_GET_VARS['ARG1']) : ( ( isset($HTTP_POST_VARS['ARG1']) ) ? ($HTTP_POST_VARS['ARG1']) : 0) ;$qid =  ( isset($HTTP_GET_VARS['ARG2']) ) ? ($HTTP_GET_VARS['ARG2']) : ( ( isset($HTTP_POST_VARS['ARG2']) ) ? ($HTTP_POST_VARS['ARG2']) : 0) ;$total_ques =  ( isset($HTTP_GET_VARS['ARG3']) ) ? ($HTTP_GET_VARS['ARG3']) : ( ( isset($HTTP_POST_VARS['ARG3']) ) ? ($HTTP_POST_VARS['ARG3']) : 0) ;$setid =  ( isset($HTTP_GET_VARS['set']) ) ? ($HTTP_GET_VARS['set']) : ( ( isset($HTTP_POST_VARS['set']) ) ? ($HTTP_POST_VARS['set']) : 0) ;//// Start session management//$userdata = session_pagestart($user_ip, PAGE_QUIZ_QUIZ);init_userprefs($userdata);//// End session managementif( $userdata['session_logged_in']) {	$sql = "SELECT q.release_quiz, c.media_dir, qs.set_id FROM ". QUIZ_TABLE. " q, ".COURSE_TABLE." c, ".QUIZ_SETTINGS_TABLE." qs WHERE qs.timeopen <= ".time(). " AND qs.timeclose >= ".time()." AND q.quiz_id = ". $qid . " AND qs.set_id = ".$setid." AND q.course_id = ".$cid." AND q.course_id = c.course_id LIMIT 1";	if ($result = $db->sql_query($sql) ) {		$quiz = $db->sql_fetchrow($result);		$release_quiz_options = explode("#", $quiz['release_quiz']);					}	$ques_order = array();	if ($release_quiz_options[0] == 1) {		for ($k = 0 ; $k < $total_ques ; $k++) {			$ques_order[$k] = $k+1; 		}		if ($release_quiz_options[2] == 1) { // scramble questions			shuffle($ques_order);		}		// test access/ change log		$sql = "INSERT INTO ". TEST_LOG_TABLE. " (user_id, quiz_id, qtime, access, answer) VALUES 					(".$userdata['session_user_id'].", ".$qid.", ".time().", '1', ' ')" ;		$r = $db->sql_query($sql);		echo '<script language="JavaScript">';			echo 'setcountdown('.create_date($HTTP_GET_VARS['tc'],1, "Y,m,d,H,i,s").');';			echo 'var answered = new Array('.$total_ques.');';		$sql1 = "INSERT INTO ".QUIZ_ATTEMPTS_TABLE." (quiz_id, user_id,ques_order,timestart) VALUES (".				$qid.", ".$userdata['session_user_id'].", '".implode(",",$ques_order)."',".time()." )";		// quiz and user id are primary key, if the query succeds it means quiz has already attempted		// so take the quiz order from table		if ( ! ( $result1 = $db->sql_query($sql1) ) ) { 					$sql2 = "SELECT ques_order FROM ".QUIZ_ATTEMPTS_TABLE." WHERE user_id = ".$userdata['session_user_id']." AND quiz_id = ".$qid. " LIMIT 1";			if ( $result2 = $db->sql_query($sql2) ) { 							if ($temp = $db->sql_fetchrow($result2)) {					$ques_order = explode(",",$temp['ques_order']);										$sql3 = " SELECT resp.answer, resp.status, ques.ques_order FROM ".QUIZ_RESPONSES_TABLE. " resp, ".QUIZ_QUESTIONS_TABLE." ques WHERE					resp.user_id = ". $userdata['session_user_id']. " AND resp.quiz_id = ". $qid. " AND resp.quiz_id = ques.quiz_id AND resp.question_id = ques.ques_id ORDER BY ques.ques_order";//		echo $sql3;					if ($result = $db->sql_query($sql3) ) {								while ( $status = $db->sql_fetchrow($result)) {							$scramble_order_key = array_search($status['ques_order'], $ques_order);							if ($status['status'] == 2) {								echo 'answered['.($scramble_order_key+1).'] = 2 ;';							} elseif ($status['status'] == 4) {								echo 'answered['.($scramble_order_key+1).'] = 4 ;';							}						} // eof while status					} // eof status resulset									} // eof get order from table fetchrow			} // eof get order from table resulset		} // eof insert attempt		echo '</script>';								} // eof release quizif ($release_quiz_options[0] == 1) {		echo '<frameset cols=\'*,220\' border="1" frameborder=1 >';	echo '<frameset rows="*,50" frameborder="NO" border="0" framespacing="0">';		echo '<frame src="quiz.php?ARG1='.$cid.'&ARG2='.$qid.'&ARG4=1&ARG3='.$total_ques.'&dir='.$quiz['media_dir'].'&set='.$quiz['set_id'].'" name="questions" title="Quiz listing" scrolling=auto>';		echo '<frame src="quiz_navi.php?ARG1='.$cid.'&ARG2='.$qid.'&ARG4=1&ARG3='.$total_ques.'&dir='.$quiz['media_dir'].'&set='.$quiz['set_id'].'" name="navigation" title="Quiz Navigation" noresize scrolling="NO">';	echo '</frameset>';	echo '<frame marginwidth=0 marginheight=0 scrolling=auto src="status.php?ARG1='.$cid.'&ARG2='.$qid.'&ARG3='.$total_ques.'&set='.$quiz['set_id'].'" name="bottom" title="Question Status">';	echo '</frameset><noframes></noframes>';}}?><layer left=0 top=0></layer></html>