<?phpdefine('IN_somCBT', true);$phpEx = 'php';$somCBT_root_path = './../';include($somCBT_root_path . 'common.php');$cid =  ( isset($HTTP_GET_VARS['ARG1']) ) ? ($HTTP_GET_VARS['ARG1']) : ( ( isset($HTTP_POST_VARS['ARG1']) ) ? ($HTTP_POST_VARS['ARG1']) : 0) ;$qid =  ( isset($HTTP_GET_VARS['ARG2']) ) ? ($HTTP_GET_VARS['ARG2']) : ( ( isset($HTTP_POST_VARS['ARG2']) ) ? ($HTTP_POST_VARS['ARG2']) : 0) ;$ques =  ( isset($HTTP_GET_VARS['ARG3']) ) ? ($HTTP_GET_VARS['ARG3']) : ( ( isset($HTTP_POST_VARS['ARG3']) ) ? ($HTTP_POST_VARS['ARG3']) : 0) ;$total_ques =  ( isset($HTTP_GET_VARS['total']) ) ? ($HTTP_GET_VARS['total']) : ( ( isset($HTTP_POST_VARS['total']) ) ? ($HTTP_POST_VARS['total']) : 0) ;$setid =  ( isset($HTTP_GET_VARS['set']) ) ? ($HTTP_GET_VARS['set']) : ( ( isset($HTTP_POST_VARS['set']) ) ? ($HTTP_POST_VARS['set']) : 0) ;//// Start session management//$userdata = session_pagestart($user_ip, PAGE_QUIZ_QUIZ);init_userprefs($userdata);//// End session managementif( $userdata['session_logged_in']) {	include($somCBT_root_path . 'includes/test_page_header.php');	$template->set_filenames(array(	'body' => 'quiz/check.tpl')	);		if ( $ques == 0 ) {		if (isset($HTTP_POST_VARS['chal'])) {			$sql = "SELECT * FROM ". QUIZ_SETTINGS_TABLE. " WHERE set_id = ".$setid. " AND timeopen <= ".time(). " AND timeclose >= ".time() ;				if ($result = $db->sql_query($sql) ) {								$row = $db->sql_fetchrow($result);							if ($row['passwd'] == $HTTP_POST_VARS['qpwd']) {									if (isIPInRange(decode_ip($userdata['session_ip']), decode_ip($row['ipfrom']), decode_ip($row['ipto'])) ) {																$sql = "SELECT COUNT(*) AS total_ques FROM ". QUIZ_QUESTIONS_TABLE . " WHERE quiz_id = ". $qid;													if ($result1 = $db->sql_query($sql) ) {								if ( $total_ques = $db->sql_fetchrow($result1) ) {								 	$tq = $total_ques['total_ques'];							 }						}						//						$sql = " REPLACE INTO ".QUIZ_ATTEMPTS_TABLE. " (quiz_id, user_id, timestart) VALUES (".$qid.", ".$userdata['session_user_id'].", ".time().")"; 						redirect(append_sid("quiz/start.php?ARG1=".$cid."&ARG2=".$qid."&ARG3=".$tq."&set=".$row['set_id'],true));											}					else {						$message = 'Your IP has been banned';					}				}				else {					$message = 'Invalid Password';				}						} // eof resultset			else {				$message = 'Oops No QUIZ available';			}		} // eof chal		$template->assign_block_vars('password',array('message' => $message));	} //eof ques set	$template->assign_vars(array(			'S_ROOTDIR' => $somCBT_root_path,			'Q_FORM_ACTION' => append_sid('check.php'),			'Q_QUIZ_ID' => $qid,			'COURSE_ID' => $cid,			'SET_ID' => $setid,				'Q_TOTAL_QUES' => $total_ques,						'S_NAV' => $nav_path)		);}else {	redirect(append_sid("login.php", true));}//// Generate the page//$template->pparse('overall_header');$template->pparse('body');include($somCBT_root_path . 'includes/page_tail.php');?>