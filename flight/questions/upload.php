<?phpdefine('IN_somCBT', true);$phpEx = 'php';$somCBT_root_path = './../';include($somCBT_root_path . 'common.php');require($somCBT_root_path . "includes/fileupload.php");$cid =  ( isset($HTTP_GET_VARS['ARG1']) ) ? ($HTTP_GET_VARS['ARG1']) : ( ( isset($HTTP_POST_VARS['ARG1']) ) ? ($HTTP_POST_VARS['ARG1']) : 0) ;$mode = ( isset($HTTP_GET_VARS['action']) ) ? ($HTTP_GET_VARS['action']) : ( ( isset($HTTP_POST_VARS['action']) ) ? ($HTTP_POST_VARS['action']) : '') ;//// Start session management//$userdata = session_pagestart($user_ip, PAGE_QUIZ_CREATE);init_userprefs($userdata);//// End session managementif( ( $userdata['session_logged_in'] ) && ( ($userdata['user_level'] == ADMIN) || ($userdata['user_level'] == TEACHER )) ){	include($somCBT_root_path . 'includes/page_header.php');		$template->set_filenames(array(	'body' => 'questions/upload.tpl'));	$script = ''; // to refresh the file list after uploading	if ( $mode == 'upload' ) {			$sql = "SELECT media_dir FROM " .COURSE_TABLE." WHERE course_id = ".$cid."  LIMIT 1";		if ( $result = $db->sql_query($sql) ) {				$script = '<script>parent.file_browse.window.location="'.append_sid('file_list.php?ARG1='.$cid).'"</script>';			$course = $db->sql_fetchrow($result) ;			$media_path_temp = upload_media($somCBT_root_path.'media/'.$course['media_dir']);		}	}	$template->assign_block_vars('upload',array( 'FORM_ACTION' => append_sid('upload.php'),													'COURSE_ID' => $cid								));	$template->assign_vars(array(				'S_ROOTDIR' => $somCBT_root_path,				'SCRIPT' => $script,				'S_NAV' => '')			);	}else {	if ( $userdata['user_level'] == STUDENT ) {		redirect(append_sid("index.php", true));		} else {		redirect(append_sid("login.php", true));	}}//// Generate the page//$template->pparse('body');?><?phpfunction upload_media($course_media_path) {global $db;// The name of the file field in your form.	$upload_file_name = "file";	// Accept only the following files	$acceptable_file_types = "image/gif|image/jpeg|video/quicktime";		// Accept ALL files	#$acceptable_file_types = "";// If no extension is supplied, and the browser or PHP can not figure out what type of file it is, you can// add a default extension - like ".jpg" or ".txt"	$default_extension = "";// MODE: if your are attempting to upload  a file with the same name as another file in the $path directory//   1 = overwrite mode    2 = create new with incremental extention   3 = do nothing if exists, highest protection	$mode = 2;			if ($_FILES[$upload_file_name]['name']) {		$my_uploader = new uploader('en'); // errors in English		$path = $course_media_path;		// $my_uploader->max_filesize(30000);		// $my_uploader->max_image_size(800, 800);		// UPLOAD the file		if ($my_uploader->upload($upload_file_name, $acceptable_file_types, $default_extension)) {			$my_uploader->save_file($path, $mode);		}				if ($my_uploader->error) {			echo '<span class="generror">'.$my_uploader->error . "</span><br>";			$my_media = array("mediafilename" =>"", "mediatype" => "");			return $my_media;		} else {			$my_media = array("mediafilename" =>$my_uploader->file['name'], "mediatype" => $my_uploader->file['extention']);			return $my_media;				 		} 	}}?>