<?phpdefine('IN_somCBT', true);$phpEx = 'php';$somCBT_root_path = './../';include($somCBT_root_path . 'common.php');$mode = ( isset($HTTP_GET_VARS['action']) ) ? ($HTTP_GET_VARS['action']) : ( ( isset($HTTP_POST_VARS['action']) ) ? ($HTTP_POST_VARS['action']) : '') ;//// Start session management//$userdata = session_pagestart($user_ip, PAGE_QUIZ_INDEX);init_userprefs($userdata);//// End session managementif( ( $userdata['session_logged_in'] ) && ($userdata['user_level'] == TEACHER ) ) {	include($somCBT_root_path . 'includes/page_header.php');	$template->set_filenames(array(	'body' => 'users/password.tpl')	);							$nav_path = 'Change Password ' ;	$message = '';	if  ($mode == 'save' ) {		$sql= "UPDATE " .USERS_TABLE. " SET user_password = md5('". $HTTP_POST_VARS['newpwd']. "') WHERE user_id = ".$userdata['session_user_id']." AND user_password = md5('".$HTTP_POST_VARS['opwd']."')";//echo $sql;		$db->sql_query($sql);		if ( $db->sql_affectedrows($sql) == 1 ){			$message = 'Password has been changed';		}else {			$message = 'Check your Old Password';		}	}// eof save		$template->assign_block_vars('password', array('HEAD' => 'Change Password',										'FORM_ACTION' => append_sid('password.php'),										'FORM_HIDDEN' => '<input type="hidden" name="action" value="save">',										'MESSAGE' => $message																			));	$template->assign_vars(array(				'S_ROOTDIR' => $somCBT_root_path,				'S_NAV' => $nav_path)			);	}else {	if ( $userdata['user_level'] == STUDENT ) {		redirect(append_sid("index.php", true));		} else {		redirect(append_sid("login.php", true));	}}//// Generate the page//$template->pparse('overall_header');$template->pparse('body');include($somCBT_root_path . 'includes/page_tail.php');?>